/*! Slovnik 29-12-2013 */
var app=angular.module("slovnik",["ngRoute","ngResource"]);app.config(["$routeProvider",function(e){"use strict";e.when("/login",{templateUrl:"/partials/login",controller:"LoginCtrl"}).when("/words",{templateUrl:"/partials/wordsList",controller:"WordsCtrl"}).when("/word/:says",{templateUrl:"/partials/word",controller:"WordCtrl"}).when("/newword",{templateUrl:"/partials/newword",controller:"NewWordCtrl"}).when("/about",{templateUrl:"/partials/about",controller:"AboutCtrl"}).otherwise({redirectTo:"/login"})}]),app.factory("logger",[function(){function e(e,o){toastr.error(e,o),t("Error: "+e)}function o(e,o){toastr.info(e,o),t("Info: "+e)}function r(e,o){toastr.success(e,o),t("Success: "+e)}function s(e,o){toastr.warning(e,o),t("Warning: "+e)}function t(){t.history=t.history||[],t.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))}toastr.options.timeOut=3e3,toastr.options.positionClass="toast-bottom-full-width";var n={error:e,info:o,success:r,warning:s,log:t};return n}]),app.controller("LoginCtrl",["$scope","$rootScope","$http","logger","messagesService",function(e,o,r,s,t){"use strict";e.messages=t.messages,e.user={},e.newUser={},e.isLogin=!0,e.buttonText=e.messages.register,e.toggleLogin=function(){e.isLogin?(e.isLogin=!1,e.buttonText=e.messages.login):(e.isLogin=!0,e.buttonText=e.messages.register)},e.canSubmit=function(){return e.isLogin?void 0!==e.user.email&&void 0!==e.user.password&&""!==e.user.email&&""!==e.user.password?!0:!1:e.checkMatch()||void 0===e.newUser.email||void 0===e.newUser.password||""===e.newUser.email||""===e.newUser.password?!1:!0},e.createUser=function(o,t,n){var a=r.post("/register",{email:o,password:t,role:n});return a.then(function(o){1===o.data.error?s.error(o.data.user+e.messages.alreadyRegistered):s.success(o.data.user+e.messages.registerSuccess)})},e.checkMatch=function(){return e.newUser.password!==e.newUser.repeatPassword}}]),app.controller("RootCtrl",["$scope","$location","$http","logger",function(e,o,r,s){"use strict";var t=r.get("/getUserDetails");t.then(function(o){1===o.data.loggedIn?(e.isLoggedIn=!0,e.email=o.data.user.email):(e.isLoggedIn=!1,e.email="Anonymous")}),e.locate=function(e){o.path(e)},e.active=function(e){return o.path()==e?!0:!1},e.login=function(o,t){var n=r.post("/login",{email:o,password:t});return n.then(function(o){1===o.data.error?s.error(e.$$childTail.messages[o.data.message]):(e.isLoggedIn=!0,window.location.href="#/words",e.email=o.data.user,s.success("Welcome "+o.data.user+"!"))})},e.logout=function(){r.post("/logout").success(function(){e.isLoggedIn=!1,window.location.href="/"})}}]),app.controller("AboutCtrl",["$scope",function(){"use strict"}]),app.controller("NewWordCtrl",["$scope","$location","wordsService","logger","messagesService",function(e,o,r,s,t){"use strict";e.messages=t.messages,e.saveWord=function(t){r.create(t).then(function(r){1===r.error?s.error(e.messages["word lost"]):(s.success(e.messages["word saved"]),o.path("/words"))},function(e){console.log(e)})},e.canSave=function(){return e.newWordForm.$valid&&e.newWordForm.$dirty?!0:!1}}]),app.controller("SecureCtrl",["$scope",function(e){"use strict";e.message="Message from Secure Controller"}]),app.controller("WordCtrl",["$scope","$routeParams","$location","wordsService","logger","messagesService",function(e,o,r,s,t,n){"use strict";e.messages=n.messages,s.get(o.says).then(function(r){e.query=o.says,e.wordExists=r.wordExists,e.word=r.word},function(e){console.log(e)}),e.deleting=!1,e.showDelete=function(){e.deleting=!0},e.cancelDelete=function(){e.deleting=!1},e.deleteWord=function(){s.removeWord(o.says).then(function(o){1===o.error?t.error(e.messages["delete failed"]):(t.success(e.messages["word deleted"]),r.path("/words"))},function(e){console.log(e)})}}]),app.controller("WordsCtrl",["$scope","wordsService",function(e,o){"use strict";o.query().then(function(o){e.wordsExist=o.wordCount>0?!0:!1,e.wordsList=o.words},function(e){console.log(e)})}]),app.factory("messagesService",function(){"use strict";return{messages:{"Bad Password":"Login Failed. Incorrect user or password. Please try again.",login:"I want to login instead",register:"I'm not registered!",registerSuccess:" was created successfully",alreadyRegistered:" is already registered!","word saved":"Yay! The word was added to the dictionary!","word lost":"Well that sucks. The word wasn't saved. :/","delete failed":"The word was not deleted","word deleted":"The word was deleted!"}}}),app.factory("wordsService",["$http","$resource","$q",function(e,o,r){var s=o("words",{},{query:{method:"GET",isArray:!1,cache:!1}}),t=o("word/:says",{says:"@says"},{get:{method:"GET",isArray:!1,cache:!0},create:{method:"PUT"},update:{method:"POST"},remove:{method:"DELETE"}}),n={query:function(){var e=r.defer();return s.query({},function(o){e.resolve(o)}),e.promise},get:function(e){var o=r.defer();return t.get({says:e},function(e){o.resolve(e)}),o.promise},create:function(e){var o=r.defer();return t.create(e,function(e){o.resolve(e)}),o.promise},update:function(e,o){console.log("update: "+e),console.log(o),t.update({says:e},o,function(e){console.log(e)})},removeWord:function(e){console.log("remove: "+e);var o=r.defer();return t.remove({says:e},function(e){o.resolve(e)}),o.promise}};return n}]);