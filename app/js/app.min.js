/*! Slovnik 31-12-2013 */
var app=angular.module("slovnik",["ngRoute","ngResource"]);app.config(["$routeProvider",function(e){"use strict";e.when("/login",{templateUrl:"/partials/login",controller:"LoginCtrl"}).when("/words",{templateUrl:"/partials/wordsList",controller:"WordsCtrl"}).when("/word/:says",{templateUrl:"/partials/word",controller:"WordCtrl"}).when("/edit/:says",{templateUrl:"/partials/editword",controller:"EditWordCtrl"}).when("/newword",{templateUrl:"/partials/newword",controller:"NewWordCtrl"}).when("/about",{templateUrl:"/partials/about",controller:"AboutCtrl"}).when("/stats",{templateUrl:"/partials/stats",controller:"StatsCtrl"}).otherwise({redirectTo:"/login"})}]),app.filter("object2Array",function(){return function(e){var o=[];for(var r in e)o.push(e[r]);return o}}),app.factory("logger",[function(){function e(e,o){toastr.error(e,o),s("Error: "+e)}function o(e,o){toastr.info(e,o),s("Info: "+e)}function r(e,o){toastr.success(e,o),s("Success: "+e)}function t(e,o){toastr.warning(e,o),s("Warning: "+e)}function s(){s.history=s.history||[],s.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))}toastr.options.timeOut=3e3,toastr.options.positionClass="toast-bottom-full-width";var n={error:e,info:o,success:r,warning:t,log:s};return n}]),app.controller("EditWordCtrl",["$scope","$location","$routeParams","wordsService","logger","messagesService",function(e,o,r,t,s,n){"use strict";e.isLoggedIn===!0?(e.messages=n.messages,t.get(r.says).then(function(o){e.query=r.says,e.wordExists=o.wordExists,e.word=o.word},function(e){console.log(e)}),e.original=angular.copy(e.word),e.cancelEdit=function(){e.word=angular.copy(e.original),o.path("/word/"+r.says)},e.saveEditedWord=function(n){n.addedby=e.email,console.log(e.email),t.update(r.says,n).then(function(r){1===r.error?s.error(e.messages["word lost"]):(s.success(e.messages["word saved"]),o.path("/word/"+r.word.says))},function(e){console.log(e)})},e.canSave=function(){return e.newWordForm.$valid&&e.newWordForm.$dirty?!0:!1}):(s.error("You need to login to edit a word"),o.path("/login"))}]),app.controller("LoginCtrl",["$scope","$rootScope","$http","logger","messagesService",function(e,o,r,t,s){"use strict";e.messages=s.messages,e.user={},e.newUser={},e.isLogin=!0,e.buttonText=e.messages.register,e.toggleLogin=function(){e.isLogin?(e.isLogin=!1,e.buttonText=e.messages.login):(e.isLogin=!0,e.buttonText=e.messages.register)},e.canSubmit=function(){return e.isLogin?void 0!==e.user.email&&void 0!==e.user.password&&""!==e.user.email&&""!==e.user.password?!0:!1:e.checkMatch()||void 0===e.newUser.email||void 0===e.newUser.password||""===e.newUser.email||""===e.newUser.password?!1:!0},e.createUser=function(o,s,n){var a=r.post("/register",{email:o,password:s,role:n});return a.then(function(o){1===o.data.error?t.error(o.data.user+e.messages.alreadyRegistered):t.success(o.data.user+e.messages.registerSuccess)})},e.checkMatch=function(){return e.newUser.password!==e.newUser.repeatPassword}}]),app.controller("RootCtrl",["$scope","$location","$http","logger",function(e,o,r,t){"use strict";var s=r.get("/getUserDetails");s.then(function(o){1===o.data.loggedIn?(e.isLoggedIn=!0,e.email=o.data.user.email):(e.isLoggedIn=!1,e.email="Anonymous")}),e.locate=function(e){o.path(e)},e.active=function(e){return o.path()==e?!0:!1},e.login=function(o,s){var n=r.post("/login",{email:o,password:s});return n.then(function(o){1===o.data.error?t.error(e.$$childTail.messages[o.data.message]):(e.isLoggedIn=!0,window.location.href="#/words",e.email=o.data.user,t.success("Welcome "+o.data.user+"!"))})},e.logout=function(){r.post("/logout").success(function(){e.isLoggedIn=!1,window.location.href="/"})}}]),app.controller("AboutCtrl",["$scope",function(){"use strict"}]),app.controller("NewWordCtrl",["$scope","$location","wordsService","logger","messagesService",function(e,o,r,t,s){"use strict";e.isLoggedIn===!0?(e.messages=s.messages,e.saveWord=function(s){r.create(s).then(function(r){1===r.error?t.error(e.messages["word lost"]):(t.success(e.messages["word saved"]),o.path("/words"))},function(e){console.log(e)})},e.cancelCreate=function(){e.word={},o.path("/words")},e.canSave=function(){return e.newWordForm.$valid&&e.newWordForm.$dirty?!0:!1}):(t.error("You need to login to create a word"),o.path("/login"))}]),app.controller("SecureCtrl",["$scope",function(e){"use strict";e.message="Message from Secure Controller"}]),app.controller("StatsCtrl",["$scope","$location","statsService","logger",function(e,o,r,t){"use strict";e.isLoggedIn===!0?r().then(function(o){console.log(o),e.stats=o},function(e){console.log(e)}):(t.error("You need to login to see the stats page"),o.path("/login"))}]),app.controller("WordCtrl",["$scope","$routeParams","$location","wordsService","logger","messagesService",function(e,o,r,t,s,n){"use strict";e.isLoggedIn===!0?(e.messages=n.messages,e.deleting=!1,t.get(o.says).then(function(r){e.query=o.says,e.wordExists=r.wordExists,e.word=r.word},function(e){console.log(e)}),e.edit=function(){r.path("/edit/"+o.says)},e.showDelete=function(){e.deleting=!0},e.cancelDelete=function(){e.deleting=!1},e.deleteWord=function(){t.removeWord(o.says).then(function(o){1===o.error?s.error(e.messages["delete failed"]):(s.success(e.messages["word deleted"]),r.path("/words"))},function(e){console.log(e)})}):(s.error("You need to login to see the definition page"),r.path("/login"))}]),app.controller("WordsCtrl",["$scope","$location","wordsService","logger",function(e,o,r,t){"use strict";e.isLoggedIn===!0?r.query().then(function(o){e.wordsExist=o.wordCount>0?!0:!1,e.wordsList=o.words},function(e){console.log(e)}):(t.error("You need to login to see the words list"),o.path("/login"))}]),app.factory("messagesService",function(){"use strict";return{messages:{"Bad Password":"Login Failed. Incorrect user or password. Please try again.",login:"I want to login instead",register:"I'm not registered!",registerSuccess:" was created successfully",alreadyRegistered:" is already registered!","word saved":"Yay! The word was added to the dictionary!","word lost":"Well that sucks. The word wasn't saved. :/","delete failed":"The word was not deleted","word deleted":"The word was deleted!"}}}),app.factory("statsService",["$http","$resource","$q",function(e,o,r){var t=o("stats",{},{query:{method:"GET",isArray:!1,cache:!0}}),s=function(){var e=r.defer();return t.query({},function(o){e.resolve(o)}),e.promise};return s}]),app.factory("wordsService",["$http","$resource","$q",function(e,o,r){var t=o("words",{},{query:{method:"GET",isArray:!1,cache:!1}}),s=o("word/:says",{says:"@says"},{get:{method:"GET",isArray:!1,cache:!0},create:{method:"PUT"},update:{method:"POST"},remove:{method:"DELETE"}}),n={query:function(){var e=r.defer();return t.query({},function(o){e.resolve(o)}),e.promise},get:function(e){var o=r.defer();return s.get({says:e},function(e){o.resolve(e)}),o.promise},create:function(e){var o=r.defer();return s.create(e,function(e){o.resolve(e)}),o.promise},update:function(e,o){var t=r.defer();return s.update({says:e},o,function(e){t.resolve(e)}),t.promise},removeWord:function(e){console.log("remove: "+e);var o=r.defer();return s.remove({says:e},function(e){o.resolve(e)}),o.promise}};return n}]);