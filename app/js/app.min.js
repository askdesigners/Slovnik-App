/*! Slovnik 30-12-2013 */
var app=angular.module("slovnik",["ngRoute","ngResource"]);app.config(["$routeProvider",function(e){"use strict";e.when("/login",{templateUrl:"/partials/login",controller:"LoginCtrl"}).when("/words",{templateUrl:"/partials/wordsList",controller:"WordsCtrl"}).when("/word/:says",{templateUrl:"/partials/word",controller:"WordCtrl"}).when("/edit/:says",{templateUrl:"/partials/editword",controller:"EditWordCtrl"}).when("/newword",{templateUrl:"/partials/newword",controller:"NewWordCtrl"}).when("/about",{templateUrl:"/partials/about",controller:"AboutCtrl"}).otherwise({redirectTo:"/login"})}]),app.factory("logger",[function(){function e(e,r){toastr.error(e,r),t("Error: "+e)}function r(e,r){toastr.info(e,r),t("Info: "+e)}function o(e,r){toastr.success(e,r),t("Success: "+e)}function s(e,r){toastr.warning(e,r),t("Warning: "+e)}function t(){t.history=t.history||[],t.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))}toastr.options.timeOut=3e3,toastr.options.positionClass="toast-bottom-full-width";var n={error:e,info:r,success:o,warning:s,log:t};return n}]),app.controller("EditWordCtrl",["$scope","$location","$routeParams","wordsService","logger","messagesService",function(e,r,o,s,t,n){"use strict";e.messages=n.messages,s.get(o.says).then(function(r){e.query=o.says,e.wordExists=r.wordExists,e.word=r.word},function(e){console.log(e)}),e.original=angular.copy(e.word),e.cancelEdit=function(){e.word=angular.copy(e.original),r.path("/word/"+o.says)},e.saveEditedWord=function(n){n.addedby=e.email,console.log(e.email),s.update(o.says,n).then(function(o){1===o.error?t.error(e.messages["word lost"]):(t.success(e.messages["word saved"]),r.path("/word/"+o.word.says))},function(e){console.log(e)})},e.canSave=function(){return e.newWordForm.$valid&&e.newWordForm.$dirty?!0:!1}}]),app.controller("LoginCtrl",["$scope","$rootScope","$http","logger","messagesService",function(e,r,o,s,t){"use strict";e.messages=t.messages,e.user={},e.newUser={},e.isLogin=!0,e.buttonText=e.messages.register,e.toggleLogin=function(){e.isLogin?(e.isLogin=!1,e.buttonText=e.messages.login):(e.isLogin=!0,e.buttonText=e.messages.register)},e.canSubmit=function(){return e.isLogin?void 0!==e.user.email&&void 0!==e.user.password&&""!==e.user.email&&""!==e.user.password?!0:!1:e.checkMatch()||void 0===e.newUser.email||void 0===e.newUser.password||""===e.newUser.email||""===e.newUser.password?!1:!0},e.createUser=function(r,t,n){var a=o.post("/register",{email:r,password:t,role:n});return a.then(function(r){1===r.data.error?s.error(r.data.user+e.messages.alreadyRegistered):s.success(r.data.user+e.messages.registerSuccess)})},e.checkMatch=function(){return e.newUser.password!==e.newUser.repeatPassword}}]),app.controller("RootCtrl",["$scope","$location","$http","logger",function(e,r,o,s){"use strict";var t=o.get("/getUserDetails");t.then(function(r){1===r.data.loggedIn?(e.isLoggedIn=!0,e.email=r.data.user.email):(e.isLoggedIn=!1,e.email="Anonymous")}),e.locate=function(e){r.path(e)},e.active=function(e){return r.path()==e?!0:!1},e.login=function(r,t){var n=o.post("/login",{email:r,password:t});return n.then(function(r){1===r.data.error?s.error(e.$$childTail.messages[r.data.message]):(e.isLoggedIn=!0,window.location.href="#/words",e.email=r.data.user,s.success("Welcome "+r.data.user+"!"))})},e.logout=function(){o.post("/logout").success(function(){e.isLoggedIn=!1,window.location.href="/"})}}]),app.controller("AboutCtrl",["$scope",function(){"use strict"}]),app.controller("NewWordCtrl",["$scope","$location","wordsService","logger","messagesService",function(e,r,o,s,t){"use strict";e.messages=t.messages,e.saveWord=function(t){o.create(t).then(function(o){1===o.error?s.error(e.messages["word lost"]):(s.success(e.messages["word saved"]),r.path("/words"))},function(e){console.log(e)})},e.cancelCreate=function(){e.word={},r.path("/words")},e.canSave=function(){return e.newWordForm.$valid&&e.newWordForm.$dirty?!0:!1}}]),app.controller("SecureCtrl",["$scope",function(e){"use strict";e.message="Message from Secure Controller"}]),app.controller("WordCtrl",["$scope","$routeParams","$location","wordsService","logger","messagesService",function(e,r,o,s,t,n){"use strict";e.messages=n.messages,e.deleting=!1,s.get(r.says).then(function(o){e.query=r.says,e.wordExists=o.wordExists,e.word=o.word},function(e){console.log(e)}),e.edit=function(){o.path("/edit/"+r.says)},e.showDelete=function(){e.deleting=!0},e.cancelDelete=function(){e.deleting=!1},e.deleteWord=function(){s.removeWord(r.says).then(function(r){1===r.error?t.error(e.messages["delete failed"]):(t.success(e.messages["word deleted"]),o.path("/words"))},function(e){console.log(e)})}}]),app.controller("WordsCtrl",["$scope","wordsService",function(e,r){"use strict";r.query().then(function(r){e.wordsExist=r.wordCount>0?!0:!1,e.wordsList=r.words},function(e){console.log(e)})}]),app.factory("messagesService",function(){"use strict";return{messages:{"Bad Password":"Login Failed. Incorrect user or password. Please try again.",login:"I want to login instead",register:"I'm not registered!",registerSuccess:" was created successfully",alreadyRegistered:" is already registered!","word saved":"Yay! The word was added to the dictionary!","word lost":"Well that sucks. The word wasn't saved. :/","delete failed":"The word was not deleted","word deleted":"The word was deleted!"}}}),app.factory("wordsService",["$http","$resource","$q",function(e,r,o){var s=r("words",{},{query:{method:"GET",isArray:!1,cache:!1}}),t=r("word/:says",{says:"@says"},{get:{method:"GET",isArray:!1,cache:!0},create:{method:"PUT"},update:{method:"POST"},remove:{method:"DELETE"}}),n={query:function(){var e=o.defer();return s.query({},function(r){e.resolve(r)}),e.promise},get:function(e){var r=o.defer();return t.get({says:e},function(e){r.resolve(e)}),r.promise},create:function(e){var r=o.defer();return t.create(e,function(e){r.resolve(e)}),r.promise},update:function(e,r){var s=o.defer();return t.update({says:e},r,function(e){s.resolve(e)}),s.promise},removeWord:function(e){console.log("remove: "+e);var r=o.defer();return t.remove({says:e},function(e){r.resolve(e)}),r.promise}};return n}]);