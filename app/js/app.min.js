/*! Slovnik 03-01-2014 */
var app=angular.module("slovnik",["ngRoute","ngResource"]);app.config(["$routeProvider",function(e){"use strict";e.when("/login",{templateUrl:"/partials/login",controller:"LoginCtrl"}).when("/words",{templateUrl:"/partials/wordsList",controller:"WordsCtrl"}).when("/word/:says",{templateUrl:"/partials/word",controller:"WordCtrl"}).when("/edit/:says",{templateUrl:"/partials/editword",controller:"EditWordCtrl"}).when("/newword",{templateUrl:"/partials/newword",controller:"NewWordCtrl"}).when("/about",{templateUrl:"/partials/about",controller:"AboutCtrl"}).when("/users",{templateUrl:"/partials/usersList",controller:"UsersCtrl"}).when("/user/:email",{templateUrl:"/partials/user",controller:"UserCtrl"}).when("/edituser/:email",{templateUrl:"/partials/edituser",controller:"EditUserCtrl"}).when("/stats",{templateUrl:"/partials/stats",controller:"StatsCtrl"}).otherwise({redirectTo:"/login"})}]),app.filter("object2Array",function(){return function(e){var r=[];for(var o in e)r.push(e[o]);return r}}),app.factory("logger",[function(){function e(e,r){toastr.error(e,r),s("Error: "+e)}function r(e,r){toastr.info(e,r),s("Info: "+e)}function o(e,r){toastr.success(e,r),s("Success: "+e)}function t(e,r){toastr.warning(e,r),s("Warning: "+e)}function s(){s.history=s.history||[],s.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))}toastr.options.timeOut=3e3,toastr.options.positionClass="toast-bottom-full-width";var n={error:e,info:r,success:o,warning:t,log:s};return n}]),app.controller("EditUserCtrl",["$scope","$location","$routeParams","usersService","langService","logger","messagesService",function(e,r,o,t,s,n,a){"use strict";e.l=s.language(),e.isLoggedIn===!0?(e.messages=a.messages,t.get(o.email).then(function(r){e.query=o.email,e.userExists=r.userExists,e.user=r.user,e.user.password="",e.user.repeatPassword=""},function(e){console.log(e)}),e.original=angular.copy(e.user),e.cancelEdit=function(){e.user=angular.copy(e.original),r.path("/user/"+o.email)},e.checkMatch=function(){return e.user?e.user.password!==e.user.repeatPassword:void 0},e.saveEditedUser=function(e){t.update(o.email,e).then(function(e){1===e.error?n.error("Couldn't update the user"):(n.success("User updated"),s.setLang(e.user.language),r.path("/user/"+e.user.email))},function(e){console.log(e)})},e.canSave=function(){return e.newUserForm.$valid&&e.newUserForm.$dirty?!0:!1}):(n.error("You need to login to edit a user"),r.path("/login"))}]),app.controller("EditWordCtrl",["$scope","$location","$routeParams","wordsService","langService","logger","messagesService",function(e,r,o,t,s,n,a){"use strict";e.l=s.language(),e.isLoggedIn===!0?(e.messages=a.messages,t.get(o.says).then(function(r){e.query=o.says,e.wordExists=r.wordExists,e.word=r.word},function(e){console.log(e)}),e.original=angular.copy(e.word),e.cancelEdit=function(){e.word=angular.copy(e.original),r.path("/word/"+o.says)},e.saveEditedWord=function(s){s.addedby=e.email,console.log(e.email),t.update(o.says,s).then(function(o){1===o.error?n.error(e.messages["word lost"]):(n.success(e.messages["word saved"]),r.path("/word/"+o.word.says))},function(e){console.log(e)})},e.canSave=function(){return e.newWordForm.$valid&&e.newWordForm.$dirty?!0:!1}):(n.error("You need to login to edit a word"),r.path("/login"))}]),app.controller("LoginCtrl",["$scope","$rootScope","$http","langService","logger","messagesService",function(e,r,o,t,s,n){"use strict";e.l=t.language(),e.messages=n.messages,e.user={},e.newUser={},e.isLogin=!0,e.buttonText=e.messages.register,e.changeLang=function(){t.setLang(e.newUser.language),e.l=t.language()},e.toggleLogin=function(){e.isLogin?(e.isLogin=!1,e.buttonText=e.l.btnNotReg):(e.isLogin=!0,e.buttonText=e.l.btnLoginInstead)},e.canSubmit=function(){return e.isLogin?void 0!==e.user.email&&void 0!==e.user.password&&""!==e.user.email&&""!==e.user.password?!0:!1:e.checkMatch()||void 0===e.newUser.email||void 0===e.newUser.password||""===e.newUser.email||""===e.newUser.password?!1:!0},e.createUser=function(r,t,n){var a=o.post("/register",{email:r,password:t,language:n});return a.then(function(o){1===o.data.error?s.error(o.data.user+e.messages.alreadyRegistered):(s.success(o.data.user+e.messages.registerSuccess),e.login(r,t))})},e.checkMatch=function(){return e.newUser.password!==e.newUser.repeatPassword}}]),app.controller("RootCtrl",["$scope","$location","$http","langService","logger",function(e,r,o,t,s){"use strict";var n=function(){e.l=t.language()};t.registerObserverCallback(n);var a=o.get("/getActiveUser");a.then(function(r){1===r.data.loggedIn?(e.isLoggedIn=!0,e.email=r.data.user.email,t.setLang(r.data.user.language),console.log(r.data.user.language)):(e.isLoggedIn=!1,e.email="Anonymous",t.setLang("en"))}),e.locate=function(e){r.path(e)},e.active=function(e){return r.path()==e?!0:!1},e.login=function(n,a){var i=o.post("/login",{email:n,password:a});return i.then(function(o){1===o.data.error?s.error(e.$$childTail.messages[o.data.message]):(e.isLoggedIn=!0,r.path("/words"),e.email=o.data.user,o.data.language?t.setLang(o.data.language):t.setLang("en"),s.success("Welcome "+o.data.user+"!")),e.l=t.language()})},e.logout=function(){o.post("/logout").success(function(){e.isLoggedIn=!1,window.location.href="/"})}}]),app.controller("AboutCtrl",["$scope","langService",function(e,r){"use strict";e.l=r.language()}]),app.controller("NewWordCtrl",["$scope","$location","wordsService","langService","logger","messagesService",function(e,r,o,t,s,n){"use strict";e.l=t.language(),e.isLoggedIn===!0?(e.messages=n.messages,e.saveWord=function(t){o.create(t).then(function(o){1===o.error?s.error(e.messages["word lost"]):(s.success(e.messages["word saved"]),r.path("/words"))},function(e){console.log(e)})},e.cancelCreate=function(){e.word={},r.path("/words")},e.canSave=function(){return e.newWordForm.$valid&&e.newWordForm.$dirty?!0:!1}):(s.error("You need to login to create a word"),r.path("/login"))}]),app.controller("SecureCtrl",["$scope",function(e){"use strict";e.message="Message from Secure Controller"}]),app.controller("StatsCtrl",["$scope","$location","statsService","langService","logger",function(e,r,o,t,s){"use strict";e.l=t.language(),e.isLoggedIn===!0?o().then(function(r){e.stats=r},function(e){console.log(e)}):(s.error("You need to login to see the stats page"),r.path("/login"))}]),app.controller("UserCtrl",["$scope","$routeParams","$location","usersService","langService","logger","messagesService",function(e,r,o,t,s,n,a){"use strict";e.l=s.language(),e.isLoggedIn===!0?(e.messages=a.messages,e.deleting=!1,console.log(r.email),t.get(r.email).then(function(o){e.query=r.email,e.userExists=o.userExists,e.user=o.user},function(e){console.log(e)}),e.edit=function(){o.path("/edituser/"+r.email)},e.showDelete=function(){e.deleting=!0},e.cancelDelete=function(){e.deleting=!1},e.deleteUser=function(){t.removeUser(r.email).then(function(e){1===e.error?n.error("The user couldn't be deleted!"):(n.success("The user was deleted!"),o.path("/users"))},function(e){console.log(e)})}):(n.error("You need to login to see a users profile"),o.path("/login"))}]),app.controller("UsersCtrl",["$scope","$location","usersService","langService","logger",function(e,r,o,t,s){"use strict";e.l=t.language(),e.isLoggedIn===!0?o.query().then(function(r){e.usersExist=r.userCount>0?!0:!1,e.usersList=r.users},function(e){console.log(e)}):(s.error("You need to login to see the users list"),r.path("/login"))}]),app.controller("WordCtrl",["$scope","$routeParams","$location","wordsService","langService","logger","messagesService",function(e,r,o,t,s,n,a){"use strict";e.l=s.language(),e.isLoggedIn===!0?(e.messages=a.messages,e.deleting=!1,t.get(r.says).then(function(o){e.query=r.says,e.wordExists=o.wordExists,e.word=o.word},function(e){console.log(e)}),e.edit=function(){o.path("/edit/"+r.says)},e.showDelete=function(){e.deleting=!0},e.cancelDelete=function(){e.deleting=!1},e.deleteWord=function(){t.removeWord(r.says).then(function(r){1===r.error?n.error(e.messages["delete failed"]):(n.success(e.messages["word deleted"]),o.path("/words"))},function(e){console.log(e)})}):(n.error("You need to login to see the definition page"),o.path("/login"))}]),app.controller("WordsCtrl",["$scope","$location","wordsService","langService","logger",function(e,r,o,t,s){"use strict";e.l=t.language(),e.isLoggedIn===!0?o.query().then(function(r){e.wordsExist=r.wordCount>0?!0:!1,e.wordsList=r.words},function(e){console.log(e)}):(s.error("You need to login to see the words list"),r.path("/login"))}]),app.factory("langService",function(){"use strict";var e=[],r=function(){angular.forEach(e,function(e){e()})},o=function(e){s.lang=e,r()},t=function(){return s.slovnik[s.lang]},s={registerObserverCallback:function(r){e.push(r)},lang:"en",setLang:o,language:t,slovnik:{en:{msNoWords:"There are no words yet!",msNoWord:"is not in the dictionary.",msNoUser:"is not a user.",msNoMatch:"Passwords do not match!",uiLanguage:"Language",btnWords:"All words",btnAdd:"Add a word",btnStats:"Stats",btnUsers:"Users",btnSignInUp:"Signup/in",btnWhatIs:"What's this?",btnViewUsers:"View all users",uiLoggedInAs:"Logged in as",uiNotLoggedIn:"You're not logged in",btnLogout:"Logout",wordSays:"When Ollie says",wordMeans:"He means",wordTrans:"Which translates from Czech as ",formEditWord:"Edit word",formDeleteWord:"Delete word",formDeleteIt:"Delete it!",formLangSet:"Language",formEmail:"Email",formEditUser:"Edit user",formDeleteUser:"Delete user",formCancel:"Cancel",formSays:"Ollie says",formMeans:"It means",formLang:"He says it in",formTrans:"It translates to",more:"More",formCancelEdit:"Cancel edit",formSave:"Save",formSignin:"Sign in",formPassword:"Password",formPasswordAgain:"Password again",formPasswordMessage:"(leave blank to keep old password)",formRemember:"Remember me",formSubmit:"Submit",statsNumber:"Number of words",english:"English",czech:"Czech",words:"Words",statsThereAre:"There are",statsUsers:"users",uiNotSigned:"You are not signed in",btnNotReg:"I'm not registered",btnLoginInstead:"I want to login instead",aboutTitle:"This is a little app to help Grandma and Papaw understand their Eurotoddler.",aboutText:"To get to the good stuff, just sign up. It also tracks what percentage of the words are in each language.<br/>It's built using Node, Angular and Bootstrap by Ryan Cole. Check out the source on Github."},cz:{msNoWords:"Neexistují slova!",msNoWord:"není v slovníku.",msNoUser:"není uživatel.",msNoMatch:"Hesla se neshodují!",uiLanguage:"Jazyk",btnWords:"Všechna slova",btnAdd:"Přidat slovo",btnStats:"Statistiky",btnUsers:"Uživatelé",btnSignInUp:"Přihlásit se",btnWhatIs:"Co je to?",btnViewUsers:"Zobrazit všechny uživatele",formLangSet:"Jazyk",formEmail:"E-mail",formEditUser:"Editovat uživatele",formDeleteUser:"Odstranit uživatele",formEditWord:"Upravit slovo",formDeleteWord:"Odstranit slovo",formDeleteIt:"Odstranit!",formCancel:"Zrušit",formSays:"Oli říká",formMeans:"To znamená, že",formLang:"On říká, že je v",formTrans:"To se promítá do",more:"Více",formCancelEdit:"Zrušit editaci",formSave:"Uložit",formSignin:"Přihlásit",formPassword:"Heslo",formPasswordAgain:"Opakujte heslo",formPasswordMessage:"(ponechte prázdné, aby se staré heslo)",formRemember:"Zapamatovat",formSubmit:"Předložit",uiLoggedInAs:"Přihlášen jako",uiNotLoggedIn:"Nejste přihlášen",btnLogout:"Odhlásit",wordSays:"Když Oli říká",wordMeans:"Se znamená",wordTrans:"který překládá z anglicky jako",statsNumber:"Počet slov",english:"Angličtina",czech:"Čeština",words:"Slova",statsThereAre:"Jsou",statsUsers:"uživatelů",uiNotSigned:"Nejste přihlášeni",btnNotReg:"Nejsem registrován",btnLoginInstead:"Chci se přihlásit",aboutTitle:"To je malá aplikace na pomoc babičky a papáji pochopit jejich Eurotoddler.",aboutText:"Chcete-li dostat do dobré věci, jen zaregistrovat. Rovněž sleduje, jaké procento slov se v každém jazyce. <br/> Je vyrobena s použitím Node.js, Angular.js a Bootstrap od Ryan Cole. Podívejte se na zdroje na GitHub."}}};return s}),app.factory("messagesService",function(){"use strict";return{messages:{"Bad Password":"Login Failed. Incorrect user or password. Please try again.",login:"I want to login instead",register:"I'm not registered!",registerSuccess:" was created successfully",alreadyRegistered:" is already registered!","word saved":"Yay! The word was added to the dictionary!","word lost":"Well that sucks. The word wasn't saved. :/","delete failed":"The word was not deleted","word deleted":"The word was deleted!"}}}),app.factory("statsService",["$http","$resource","$q",function(e,r,o){var t=r("stats",{},{query:{method:"GET",isArray:!1,cache:!0}}),s=function(){var e=o.defer();return t.query({},function(r){e.resolve(r)}),e.promise};return s}]),app.factory("usersService",["$http","$resource","$q",function(e,r,o){var t=r("users",{},{query:{method:"GET",isArray:!1,cache:!1}}),s=r("user/:email",{email:"@email"},{get:{method:"GET",isArray:!1,cache:!1},create:{method:"PUT"},update:{method:"POST"},remove:{method:"DELETE"}}),n={query:function(){var e=o.defer();return t.query({},function(r){e.resolve(r)}),e.promise},get:function(e){var r=o.defer();return s.get({email:e},function(e){r.resolve(e)}),r.promise},create:function(e){var r=o.defer();return s.create(e,function(e){r.resolve(e)}),r.promise},update:function(e,r){var t=o.defer();return s.update({email:e},r,function(e){t.resolve(e)}),t.promise},removeUser:function(e){var r=o.defer();return s.remove({email:e},function(e){r.resolve(e)}),r.promise}};return n}]),app.factory("wordsService",["$http","$resource","$q",function(e,r,o){var t=r("words",{},{query:{method:"GET",isArray:!1,cache:!1}}),s=r("word/:says",{says:"@says"},{get:{method:"GET",isArray:!1,cache:!1},create:{method:"PUT"},update:{method:"POST"},remove:{method:"DELETE"}}),n={query:function(){var e=o.defer();return t.query({},function(r){e.resolve(r)}),e.promise},get:function(e){var r=o.defer();return s.get({says:e},function(e){r.resolve(e)}),r.promise},create:function(e){var r=o.defer();return s.create(e,function(e){r.resolve(e)}),r.promise},update:function(e,r){var t=o.defer();return s.update({says:e},r,function(e){t.resolve(e)}),t.promise},removeWord:function(e){console.log("remove: "+e);var r=o.defer();return s.remove({says:e},function(e){r.resolve(e)}),r.promise}};return n}]);